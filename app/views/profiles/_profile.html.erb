<% if previewing?(profile) %>
  <div data-controller="bridge--menu" data-menu-ios-image="square.and.pencil" data-menu-android-image="edit_square" class="hotwire-native:hidden w-full flex flex-row items-center justify-center my-4">
    <%= link_to edit_profile_path(profile),
      class: "p-2 px-4 mx-2 bg-slate-50 hover:bg-slate-200 rounded-full text-blue-600 hover:text-blue-700 font-semibold text-sm",
      data: {
        bridge__menu_target: "item",
        bridge_title: "Edit Profile",
        bridge_ios_image: "person.crop.circle",
        bridge_android_image: "edit_note"
      } do
    %>
      <div class="flex flex-row items-center">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 md:mr-2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
        </svg>
        <span class="hidden md:inline"><%= t("profile_nav.profile") %></span>
      </div>
    <% end %>

    <%= link_to profile_images_path(profile),
      class: "p-2 px-4 mx-2 bg-slate-50 hover:bg-slate-200 rounded-full text-blue-600 hover:text-blue-700 font-semibold text-sm",
      data: {
        bridge__menu_target: "item",
        bridge_title: "Edit Photos",
        bridge_ios_image: "photo.stack",
        bridge_android_image: "photo_library"
      } do
    %>
      <div class="flex flex-row items-center">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 md:mr-2">
          <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
        </svg>
        <span class="hidden md:inline"><%= t("profile_nav.photos") %></span>
      </div>
    <% end %>

    <%= link_to cards_path,
      class: "p-2 px-4 mx-2 bg-slate-50 hover:bg-slate-200 rounded-full text-blue-600 hover:text-blue-700 font-semibold text-sm",
      data: {
        bridge__menu_target: "item",
        bridge_title: "Edit Cards",
        bridge_ios_image: "folder.badge.person.crop",
        bridge_android_image: "layers"
      } do
    %>
      <div class="flex flex-row items-center">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 md:mr-2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 9h3.75M15 12h3.75M15 15h3.75M4.5 19.5h16.5a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Zm6-10.125a1.875 1.875 0 1 1-3.75 0 1.875 1.875 0 0 1 3.75 0Zm1.294 6.336a6.721 6.721 0 0 1-3.17.789 6.721 6.721 0 0 1-3.168-.789 3.376 3.376 0 0 1 6.338 0Z" />
        </svg>
        <span class="hidden md:inline"><%= t("profile_nav.cards") %></span>
      </div>
    <% end %>

    <%= link_to user_path(Current.user),
      class: "p-2 px-4 mx-2 bg-slate-50 hover:bg-slate-200 rounded-full text-blue-600 hover:text-blue-700 font-semibold text-sm",
      data: {
        bridge__menu_target: "item",
        bridge_title: "Edit Account",
        bridge_ios_image: "folder.badge.person.crop",
        bridge_android_image: "layers"
      } do
    %>
      <div class="flex flex-row items-center">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 md:mr-2">
          <path fill-rule="evenodd" d="M7.5 6a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM3.751 20.105a8.25 8.25 0 0 1 16.498 0 .75.75 0 0 1-.437.695A18.683 18.683 0 0 1 12 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 0 1-.437-.695Z" clip-rule="evenodd" />
        </svg>
        <span class="hidden md:inline"><%= t("profile_nav.account") %></span>
      </div>
    <% end %>
  </div>
<% end %>

<div data-controller="<%= previewing?(profile) || assessed?(profile) ? "" : "swiper" %>" class="container h-dvh w-full mt-4 mb-24">
  <div class="flex flex-col items-center justify-center relative rounded" data-swiper-target="images">
    <div class="border border-blue-300 size-96 relative my-auto object-cover rounded light:bg-white dark:bg-black" data-controller="gallery">
      <% profile.images.each_with_index do |image| %>
        <% next unless image.photo.attached? %>
        <% next unless image.photo.variable? %>
        <% next unless image.photo.key.present? %>

        <% if image.photo.content_type.start_with?('image/') %>
          <%= image_tag image.photo.variant(:standard), class: "object-cover h-full w-full absolute top-0 light:bg-white dark:bg-black rounded", style: "touch-action: manipulation;"  %>
        <% else %>
          <%= image_tag image.photo, class: "object-cover h-full w-full absolute top-0 light:bg-white dark:bg-black rounded", style: "touch-action: manipulation;"  %>
        <% end %>
      <% end %>
    </div>
  </div>

  <%= render partial: "profiles/partnerships", locals: { profile: profile } %>

  <div class="flex flex-col w-full overflow-clip">
    <div class="text-2xl font-bold mt-4 mx-4">
      <%= profile.display_name %>
    </div>
    <div class="text-sm mx-4">
      <%= "#{age(profile.born_on)}yo" unless profile.born_on.blank? %> â€¢ <%= profile.city %>
    </div>
    <div class="mb-4 mt-2">
      <%= render partial: "profiles/details", locals: { profile: profile } %>
    </div>
    <div class="my-4 mb-14">
      <%= render partial: "profiles/cards", locals: { profile: profile } %>
    </div>
  </div>

  <% unless assessed?(profile) || previewing?(profile) # assessed? returns true if blocked %>
    <div class="flex flex-row mx-auto fixed bottom-0 w-full justify-center">
      <%= button_to 'Pass', profile_assessments_path(profile_id: profile.id, kind: :passed), method: :post, class: "m-4 bg-red-500 text-white py-2 px-4 rounded-full", data: { 'swiper-target': "passButton" } %>
      <%= button_to 'Like', profile_assessments_path(profile_id: profile.id, kind: :liked), method: :post, class: "m-4 bg-blue-500 text-white py-2 px-4 rounded-full", data: { 'swiper-target': "likeButton" } %>
    </div>

    <div class="mb-12 flex justify-center">
      <%= button_to t('security.block_cta', name: profile.display_name),
        profile_assessments_path(profile_id: profile.id, kind: :blocked),
        method: :post,
        data: {
          controller: "bridge--button",
          bridge_position: "right",
          bridge_ios_image: "person.slash",
          bridge_android_image: "tune",
          bridge_vibrate: true,
          turbo_method: :post,
          turbo_confirm: t('security.block_user', name: profile.display_name)
        },
        class: "m-4 mb-24 bg-red-500 text-white py-2 px-4 rounded-full hotwire-native:hidden"
      %>
    </div>
  <% end %>

</div>
